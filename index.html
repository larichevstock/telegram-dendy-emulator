<!DOCTYPE html>
<html>
<head>
    <title>Dendy Emulator –¥–ª—è Telegram</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ */
        body, html { height: 100%; margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; -webkit-tap-highlight-color: transparent; background-color: #282c34; color: #ffffff; overflow-x: hidden; }
        .retro-container { width: 100%; max-width: 1200px; margin: 0 auto; padding: 15px; box-sizing: border-box; }
        /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; background: linear-gradient(90deg, #ff0080, #ff8c00); border-radius: 12px; padding: 10px 15px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); }
        .logo { display: flex; align-items: center; } .logo img { width: 50px; height: 50px; border-radius: 50%; margin-right: 10px; border: 2px solid #fff; } .logo-text { font-family: 'Press Start 2P', cursive; color: #fff; text-shadow: 2px 2px 0 #000; } .logo-text h1 { margin: 0; font-size: 1.5em; } .logo-text p { margin: 5px 0 0 0; font-size: 0.8em; } .navigation { display: flex; gap: 10px; } .nav-button { background-color: rgba(0,0,0,0.3); color: #fff; border: none; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 18px; transition: all 0.2s; } .nav-button:hover { background-color: rgba(0,0,0,0.5); transform: scale(1.1); }
        /* –ü–æ–∏—Å–∫–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ */
        .search-container { position: relative; margin-bottom: 20px; max-width: 1200px; width: 100%; margin-left: auto; margin-right: auto; } .search-input { width: 100%; padding: 15px 45px 15px 20px; border: none; border-radius: 25px; background-color: rgba(255, 255, 255, 0.1); color: #fff; font-size: 16px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); transition: all 0.3s; box-sizing: border-box; } .search-input:focus { outline: none; background-color: rgba(255, 255, 255, 0.15); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); } .search-button { position: absolute; right: 5px; top: 5px; background: linear-gradient(90deg, #ff0080, #ff8c00); color: #fff; border: none; border-radius: 20px; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 18px; transition: all 0.2s; } .search-button:hover { transform: scale(1.05); }
        /* –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ */
        .categories { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px; } .category-card { background: linear-gradient(135deg, #1e2033, #373b59); border-radius: 12px; padding: 15px; display: flex; flex-direction: column; align-items: center; text-align: center; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2); overflow: hidden; position: relative; } .category-card:hover { transform: translateY(-5px); box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3); } .category-icon { font-size: 36px; margin-bottom: 10px; position: relative; z-index: 1; } .category-icon img { width: 60px; height: 60px; object-fit: contain; } .category-title { font-family: 'Press Start 2P', cursive; font-size: 14px; color: #fff; text-shadow: 1px 1px 0 #000; margin: 0; position: relative; z-index: 1; line-height: 1.3; word-break: break-word; } .category-card::after { content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(135deg, rgba(255, 0, 128, 0.1), rgba(255, 140, 0, 0.1)); z-index: 0; opacity: 0; transition: opacity 0.3s; } .category-card:hover::after { opacity: 1; }
        /* –ë–æ–ª—å—à–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ */
        .featured-games { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px; } .featured-card { background: linear-gradient(135deg, #373b59, #1e2033); border-radius: 12px; padding: 20px; position: relative; overflow: hidden; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2); display: flex; flex-direction: column; } .featured-card:hover { transform: translateY(-5px); box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3); } .featured-content { position: relative; z-index: 1; flex-grow: 1; } .featured-title { font-family: 'Press Start 2P', cursive; font-size: 16px; color: #fff; text-shadow: 1px 1px 0 #000; margin: 0 0 30px 0; } .featured-image { width: 100%; height: 120px; object-fit: contain; margin-top: auto; } .arrow-button { position: absolute; bottom: 10px; right: 10px; background: linear-gradient(90deg, #ff0080, #ff8c00); color: #fff; border: none; border-radius: 50%; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 20px; font-weight: bold; transition: all 0.2s; z-index: 2; } .arrow-button:hover { transform: scale(1.1); }
        /* –°–µ–∫—Ü–∏—è 8-bit –•–∏—Ç—ã –∏ —Å–µ—Ç–∫–∞ –∏–≥—Ä */
        .retro-hits { margin-bottom: 20px; } .retro-hits-title { font-family: 'Press Start 2P', cursive; font-size: 18px; color: #fff; text-shadow: 1px 1px 0 #000; margin: 0 0 15px 0; text-align: center; } .retro-games-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 15px; } .retro-game-card { background: linear-gradient(135deg, #1e2033, #373b59); border-radius: 12px; padding: 15px; display: flex; flex-direction: column; align-items: center; text-align: center; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2); overflow: hidden; } .retro-game-card:hover { transform: translateY(-5px); box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3); } .retro-game-image { display: block; width: 100%; max-width: 90px; height: auto; object-fit: contain; margin-bottom: 8px; border-radius: 8px; background-color: rgba(0,0,0,0.1); } .retro-game-title { font-family: 'Press Start 2P', cursive; font-size: 12px; color: #fff; margin: 0; line-height: 1.3; word-break: break-word; }
        /* ROM –ó–∞–≥—Ä—É–∑–∫–∞ */
        .rom-upload { background: linear-gradient(135deg, #1e2033, #373b59); border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2); } .rom-upload-title { font-family: 'Press Start 2P', cursive; font-size: 18px; color: #fff; text-shadow: 1px 1px 0 #000; margin: 0 0 15px 0; text-align: center; } .upload-box { width: 100%; height: 120px; border: 2px dashed #555; border-radius: 8px; display: flex; align-items: center; justify-content: center; background-color: rgba(0, 0, 0, 0.2); transition: all 0.3s; cursor: pointer; position: relative; } .upload-box:hover, .upload-box[drag] { border-color: #ff0080; background-color: rgba(0, 0, 0, 0.3); } .file-input { position: absolute; width: 100%; height: 100%; opacity: 0; cursor: pointer; z-index: 10; } .upload-text { font-size: 16px; color: #aaa; text-align: center; padding: 0 15px; } .upload-text strong { color: #fff; display: block; margin-bottom: 5px; }
        /* –ù–æ–≤–æ—Å—Ç–∏/–ë–∞–Ω–Ω–µ—Ä */
        .news-banner { background: linear-gradient(135deg, #1e2033, #373b59); border-radius: 12px; padding: 20px; margin-bottom: 20px; position: relative; overflow: hidden; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2); } .news-banner:hover { box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3); } .news-content { position: relative; z-index: 1; display: flex; align-items: center; } .news-text { flex: 1; } .news-title { font-family: 'Press Start 2P', cursive; font-size: 16px; color: #fff; text-shadow: 1px 1px 0 #000; margin: 0 0 10px 0; } .news-description { color: rgba(255, 255, 255, 0.8); margin: 0; font-size: 14px; } .news-icon { font-size: 36px; color: #ff0080; margin-right: 15px; }
        /* –≠–º—É–ª—è—Ç–æ—Ä –∏ –µ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ */
        #display { width: 100%; height: calc(100vh - 160px); max-height: 600px; background-color: #000; border-radius: 12px; overflow: hidden; position: relative; margin-bottom: 20px; } #game { width: 100%; height: 100%; } #backButton { position: fixed; top: 15px; left: 15px; background-color: rgba(0,0,0,0.3); color: white; border: none; border-radius: 50%; width: 36px; height: 36px; display: none; align-items: center; justify-content: center; cursor: pointer; z-index: 1002; font-size: 22px; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.2); } #backButton:hover { background-color: rgba(0,0,0,0.5); } #reloadEmulatorButton { position: fixed; top: 15px; right: 15px; background-color: rgba(0,0,0,0.3); color: white; border: none; border-radius: 50%; width: 36px; height: 36px; display: none; align-items: center; justify-content: center; cursor: pointer; z-index: 1002; font-size: 20px; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.2); } #reloadEmulatorButton:hover { background-color: rgba(0,0,0,0.5); } #orientationMessage { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.9); z-index: 2000; display: none; flex-direction: column; align-items: center; justify-content: center; color: white; text-align: center; padding: 20px; box-sizing: border-box; transition: opacity 0.3s ease; -webkit-tap-highlight-color: transparent; user-select: none; } #startPlayButton { background-color: #FF0000; color: white; border: none; border-radius: 8px; padding: 15px 30px; font-size: 20px; font-weight: bold; margin-bottom: 30px; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.3); transition: transform 0.1s ease, background-color 0.2s ease; -webkit-tap-highlight-color: transparent; } #startPlayButton:hover { background-color: #D00000; transform: translateY(2px); } .loading-state { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8); z-index: 2000; display: none; flex-direction: column; align-items: center; justify-content: center; color: white; text-align: center; } .loading-spinner { width: 50px; height: 50px; border: 5px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: white; animation: spin 1s ease-in-out infinite; } @keyframes spin { to { transform: rotate(360deg); } } .loading-indicator { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 2000; display: none; } .loading-indicator::after { content: ""; width: 50px; height: 50px; border: 5px solid #fff; border-radius: 50%; border-top-color: transparent; animation: spin 1s linear infinite; }
        /* –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º */
        .fullscreen-mode #display { position: fixed !important; top: 0 !important; left: 0 !important; width: 100vw !important; height: 100vh !important; max-height: none !important; z-index: 1000 !important; border-radius: 0 !important; margin: 0 !important; padding: 0 !important; overflow: hidden !important; background-color: #000 !important; } .fullscreen-mode #game { width: 100% !important; height: 100% !important; position: relative !important; display: flex !important; align-items: center !important; justify-content: center !important; overflow: hidden !important; background-color: #000 !important; } .fullscreen-mode #game canvas { object-fit: contain !important; max-width: 100% !important; max-height: 100% !important; width: auto !important; height: auto !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; image-rendering: pixelated !important; background-color: #000 !important; -webkit-backface-visibility: hidden !important; backface-visibility: hidden !important; } .fullscreen-mode .ejs_virtualGamepad, .fullscreen-mode .ejs_virtualGamepad_button, .fullscreen-mode .ejs_virtualGamepad_touchpad { z-index: 1002 !important; } .hidden { display: none !important; } body.touch-disabled { touch-action: none !important; -ms-touch-action: none !important; overflow: hidden !important; }
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–µ–∫—Ü–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞ –∏ –Ω–µ–¥–∞–≤–Ω–∏—Ö –∏–≥—Ä */
        #search-results-area { padding-top: 20px; } .search-results-title { font-family: 'Press Start 2P', cursive; font-size: 18px; color: #fff; text-shadow: 1px 1px 0 #000; margin: 0 0 15px 0; text-align: center; } .back-to-main-button { display: block; margin: 20px auto 10px auto; padding: 10px 20px; font-family: 'Press Start 2P', cursive; font-size: 12px; color: #fff; background: linear-gradient(90deg, #555, #333); border: none; border-radius: 8px; cursor: pointer; transition: background 0.3s; text-shadow: 1px 1px 0 #000; } .back-to-main-button:hover { background: linear-gradient(90deg, #666, #444); }
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (min-width: 768px) { .categories { grid-template-columns: repeat(3, 1fr); } .retro-games-grid { grid-template-columns: repeat(4, 1fr); } } @media (max-width: 600px) { .header { flex-direction: column; text-align: center; padding: 15px; } .logo { margin-bottom: 10px; justify-content: center; } .navigation { width: 100%; justify-content: center; } .featured-games { grid-template-columns: 1fr; } .news-content { flex-direction: column; text-align: center; } .news-icon { margin: 0 0 15px 0; } .retro-games-grid { grid-template-columns: repeat(2, 1fr); gap: 10px; } } @media (max-width: 480px) { .rom-upload-title, .retro-hits-title { font-size: 14px; } .upload-box { height: 100px; } .upload-text { font-size: 14px; } .search-results-title { font-size: 16px; } } @media (max-width: 360px) { .retro-games-grid { grid-template-columns: repeat(2, 1fr); gap: 8px; } .retro-game-image { max-width: 70px; } .retro-game-title { font-size: 10px; } .retro-game-card { padding: 10px 5px; } .category-title { font-size: 12px; } }
    </style>
</head>
<body>
    <div class="retro-container" id="retro-container">
        <div class="header">
            <div class="logo"> <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBmaWxsPSIjRkYwMDAwIiBkPSJNNTAsMTBjMjIuMSwwLDQwLDE3LjksNDAsNDBTNzIuMSw5MCw1MCw5MFMxMCw3Mi4xLDEwLDUwUzI3LjksMTAsNTAsMTB6Ii8+PHBhdGggZmlsbD0iI0ZGRkZGRiIgZD0iTTM1LDM1aDMwdjMwSDM1VjM1eiIvPjxjaXJjbGUgZmlsbD0iI0ZGRkZGRiIgY3g9IjI1IiBjeT0iMzUiIHI9IjUiLz48Y2lyY2xlIGZpbGw9IiNGRkZGRkYiIGN4PSI3NSIgY3k9IjM1IiByPSI1Ii8+PGNpcmNsZSBmaWxsPSIjRkZGRkZGIiBjeD0iNzUiIGN5PSI2NSIgcj0iNSIvPjxjaXJjbGUgZmlsbD0iI0ZGRkZGRiIgY3g9IjI1IiBjeT0iNjUiIHI9IjUiLz48L3N2Zz4=" alt="Logo" /> <div class="logo-text"> <h1>Dendy</h1> <p>–†–µ—Ç—Ä–æ-—ç–º—É–ª—è—Ç–æ—Ä</p> </div> </div>
            <div class="navigation"> <button class="nav-button" title="–ì–ª–∞–≤–Ω–∞—è">üè†</button> <button class="nav-button" title="–ö–∞—Ç–∞–ª–æ–≥ –∏–≥—Ä">üéÆ</button> <button class="nav-button" title="–ò–∑–±—Ä–∞–Ω–Ω–æ–µ">‚≠ê</button> </div>
        </div>

        <div class="search-container">
            <input type="text" class="search-input" placeholder="–ü–æ–∏—Å–∫ –ª—é–±–∏–º—ã—Ö –∏–≥—Ä..." />
            <button class="search-button">üîç</button>
        </div>

        <div id="main-content">
            <div class="categories">
                <div class="category-card"> <div class="category-icon">üèÜ</div> <h3 class="category-title">–¢–û–ü –ò–ì–†</h3> </div>
                <div class="category-card"> <div class="category-icon">üî§</div> <h3 class="category-title">–ü–û –ê–õ–§–ê–í–ò–¢–£</h3> </div>
                <div class="category-card"> <div class="category-icon">üé≤</div> <h3 class="category-title">–°–õ–£–ß–ê–ô–ù–ê–Ø</h3> </div>
                <div class="category-card"> <div class="category-icon">üìä</div> <h3 class="category-title">–ü–û–ü–£–õ–Ø–†–ù–´–ï</h3> </div>
                <div class="category-card" id="recent-games-btn"> <div class="category-icon">üîÑ</div> <h3 class="category-title">–ù–ï–î–ê–í–ù–ò–ï</h3> </div> <div class="category-card"> <div class="category-icon">üì±</div> <h3 class="category-title">–ü–û–î–ï–õ–ò–¢–¨–°–Ø</h3> </div>
            </div>

            <div class="retro-hits">
                <h2 class="retro-hits-title">8-BIT –•–ò–¢–´</h2>
                <div class="retro-games-grid" id="retro-games-grid">
                    </div>
            </div>

            <div class="rom-upload">
                <h2 class="rom-upload-title">–ó–ê–ì–†–£–ó–ò–¢–¨ ROM</h2>
                <div class="upload-box" id="upload-box">
                    <input type="file" id="fileInput" accept=".nes,.fds,.unif,.unf" class="file-input">
                    <div class="upload-text"> <strong>–ó–∞–≥—Ä—É–∑–∏—Ç–µ ROM-—Ñ–∞–π–ª</strong> –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –∑–¥–µ—Å—å </div>
                </div>
            </div>

            <div class="featured-games">
                <div class="featured-card"> <div class="featured-content"> <h3 class="featured-title">–ü–†–û–î–û–õ–ñ–ò–¢–¨ –ò–ì–†–£</h3> <img src="data/img/next.png" alt="–ü–†–û–î–û–õ–ñ–ò–¢–¨ –ò–ì–†–£" class="featured-image"> </div> <button class="arrow-button">‚Üí</button> </div>
                <div class="featured-card"> <div class="featured-content"> <h3 class="featured-title">–ö–ê–¢–ê–õ–û–ì –ò–ì–†</h3> <img src="data/img/catalog.png" alt="Dendy –∫–∞—Ç–∞–ª–æ–≥" class="featured-image"> </div> <button class="arrow-button">‚Üí</button> </div>
            </div>

            <div class="news-banner">
                <div class="news-content"> <div class="news-icon">üì∞</div> <div class="news-text"> <h3 class="news-title">–ù–û–í–û–°–¢–ò –ò –û–ë–ù–û–í–õ–ï–ù–ò–Ø</h3> <p class="news-description">–°–ª–µ–¥–∏—Ç–µ –∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏ –∏ –Ω–æ–≤—ã–º–∏ –∏–≥—Ä–∞–º–∏ –≤ –Ω–∞—à–µ–º –∫–∞–Ω–∞–ª–µ!</p> </div> <button class="arrow-button">‚Üí</button> </div>
            </div>
        </div> <div id="search-results-area" class="hidden">
            </div>

        <div id="display" class="hidden">
            <div id="game"></div>
        </div>
    </div> <button id="backButton">&#10229;</button>
    <button id="reloadEmulatorButton">‚Üª</button>

    <div id="orientationMessage">
        <button id="startPlayButton">–ù–∞—á–∞—Ç—å –∏–≥—Ä–∞—Ç—å</button>
        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"> <path d="M17 2H7C5.9 2 5 2.9 5 4v16c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"></path> <path d="M12 18h.01"></path> </svg>
        <h2 style="margin: 15px 0;">–î–ª—è –ª—É—á—à–µ–≥–æ –æ–ø—ã—Ç–∞</h2>
        <p style="font-size: 16px; margin: 0 0 20px 0;">–ü–æ–≤–µ—Ä–Ω–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –±–æ–ª–µ–µ –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–π –∏–≥—Ä—ã</p>
    </div>

    <div id="loadingState" class="loading-state">
        <div class="loading-spinner"></div>
        <p>–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —ç–º—É–ª—è—Ç–æ—Ä–∞...</p>
    </div>

    <div id="loadingIndicator" class="loading-indicator"></div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const enableDebug = false; const enableThreads = false; const defaultCore = "nes";
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

        document.addEventListener('DOMContentLoaded', function() {
            // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            const fileInput = document.getElementById('fileInput'); const uploadBox = document.getElementById('upload-box'); const display = document.getElementById('display'); const backButton = document.getElementById('backButton'); const reloadEmulatorButton = document.getElementById('reloadEmulatorButton'); const startPlayButton = document.getElementById('startPlayButton'); const orientationMessage = document.getElementById('orientationMessage'); const loadingState = document.getElementById('loadingState'); const mainContent = document.getElementById('main-content'); const initialRetroGamesGrid = document.getElementById('retro-games-grid'); const searchInput = document.querySelector('.search-input'); const searchButton = document.querySelector('.search-button'); const searchResultsArea = document.getElementById('search-results-area');
            const recentGamesButton = document.getElementById('recent-games-btn'); // --- –ù–ï–î–ê–í–ù–ò–ï –ò–ì–†–´ ---

            // –°–ø–∏—Å–æ–∫ –∏–≥—Ä (–æ—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö)
            const libraryGames = [
                { id: "mario", title: "Super Mario Bros", romUrl: "roms/Mario.nes" },
                { id: "contra", title: "Contra", romUrl: "roms/Contra.nes" },
                { id: "battle_city", title: "Battle City", romUrl: "roms/Battle City.nes" },
                { id: "duck_hunt", title: "Duck Hunt", romUrl: "roms/Duck Hunt.nes" },
                { id: "tetris", title: "Tetris", romUrl: "roms/Tetris.nes" },
                { id: "ninja_gaiden", title: "Ninja Gaiden", romUrl: "roms/Ninja Gaiden.nes" }
            ];

            // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
            window.orientationShown = false; window.currentRomUrl = null; window.currentGameName = null; window.isEmulatorActive = false;

            // –ö–∞—Ä—Ç–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
            const imageMap = { "mario": "mario.webp", "contra": "contra.webp", "battle_city": "battlecity.webp", "duck_hunt": "duckhunt.webp", "tetris": "tetris.webp", "ninja_gaiden": "ninja.webp" };
            const imgBasePath = "data/img/games/";

            // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ —Å–µ—Ç–∫–∏ –∏–≥—Ä
            function renderGamesGrid(gamesToRender, targetGridElement) {
                targetGridElement.innerHTML = '';
                if (!gamesToRender || gamesToRender.length === 0) {
                    targetGridElement.innerHTML = '<p style="color: #aaa; grid-column: 1 / -1; text-align: center; margin-top: 20px;">–ò–≥—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</p>';
                    return;
                }
                gamesToRender.forEach(game => {
                    if (!game || !game.id || !game.title || !game.romUrl) { console.warn("–ü—Ä–æ–ø—É—Å–∫ –∏–≥—Ä—ã —Å –Ω–µ–ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:", game); return; }
                    const gameCard = document.createElement('div'); gameCard.className = 'retro-game-card';
                    const imageName = imageMap[game.id] || "placeholder.webp";
                    const imagePath = imgBasePath + imageName;
                    gameCard.innerHTML = `<img src="${imagePath}" alt="${game.title}" class="retro-game-image" onerror="this.style.display='none'; this.onerror=null;"><div class="retro-game-title">${game.title}</div>`;
                    gameCard.addEventListener('click', () => loadGameFromUrl(game.romUrl, game.title));
                    targetGridElement.appendChild(gameCard);
                });
            }

            // –§—É–Ω–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ–∏—Å–∫–∞
            function performSearch() {
                const searchTerm = searchInput.value.toLowerCase().trim(); if (!searchTerm) return;
                const filteredGames = libraryGames.filter(game => game.title.toLowerCase().includes(searchTerm));
                searchResultsArea.innerHTML = '';
                const titleElement = document.createElement('h2'); titleElement.className = 'search-results-title'; titleElement.textContent = `–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞: "${searchInput.value}"`; searchResultsArea.appendChild(titleElement);
                const backToMainButton = document.createElement('button'); backToMainButton.className = 'back-to-main-button'; backToMainButton.textContent = '‚Äπ –ù–∞–∑–∞–¥ –∫ –∏–≥—Ä–∞–º'; backToMainButton.onclick = showMainContent; searchResultsArea.appendChild(backToMainButton);
                const resultsGrid = document.createElement('div'); resultsGrid.className = 'retro-games-grid'; searchResultsArea.appendChild(resultsGrid);
                renderGamesGrid(filteredGames, resultsGrid);
                mainContent.classList.add('hidden'); searchResultsArea.classList.remove('hidden'); window.scrollTo(0, 0);
            }

            // –§—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ –æ—Å–Ω–æ–≤–Ω–æ–º—É –∫–æ–Ω—Ç–µ–Ω—Ç—É
            function showMainContent() { searchResultsArea.classList.add('hidden'); mainContent.classList.remove('hidden'); searchInput.value = ''; }

            // --- –ù–ï–î–ê–í–ù–ò–ï –ò–ì–†–´ ---
            // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ–¥–∞–≤–Ω–∏—Ö –∏–≥—Ä
            function showRecentGames() {
                try {
                    const recentGames = JSON.parse(localStorage.getItem('recentGamesList') || '[]');
                    searchResultsArea.innerHTML = '';
                    const titleElement = document.createElement('h2'); titleElement.className = 'search-results-title'; titleElement.textContent = '–ù–µ–¥–∞–≤–Ω–∏–µ –∏–≥—Ä—ã'; searchResultsArea.appendChild(titleElement);
                    const backToMainButton = document.createElement('button'); backToMainButton.className = 'back-to-main-button'; backToMainButton.textContent = '‚Äπ –ù–∞–∑–∞–¥ –∫ –∏–≥—Ä–∞–º'; backToMainButton.onclick = showMainContent; searchResultsArea.appendChild(backToMainButton);
                    const resultsGrid = document.createElement('div'); resultsGrid.className = 'retro-games-grid'; searchResultsArea.appendChild(resultsGrid);
                    renderGamesGrid(recentGames, resultsGrid);
                    mainContent.classList.add('hidden'); searchResultsArea.classList.remove('hidden'); window.scrollTo(0, 0);
                } catch (e) { console.error("–û—à–∏–±–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ–¥–∞–≤–Ω–∏—Ö –∏–≥—Ä:", e); alert("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –Ω–µ–¥–∞–≤–Ω–∏—Ö –∏–≥—Ä."); }
            }

            // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã –ø–æ URL
            function loadGameFromUrl(romUrl, gameName) { loadGame(romUrl, gameName, defaultCore); }

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤
            uploadBox.addEventListener('dragover', function(e) { e.preventDefault(); this.setAttribute("drag", true); });
            uploadBox.addEventListener('dragleave', function() { this.removeAttribute("drag"); });
            uploadBox.addEventListener('drop', function(e) { e.preventDefault(); this.removeAttribute("drag"); if (e.dataTransfer.files.length > 0) { handleRomFile(e.dataTransfer.files[0]); } });

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
            fileInput.addEventListener('change', function() { if (this.files.length > 0) { handleRomFile(this.files[0]); } });

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ ROM-—Ñ–∞–π–ª–∞
            function handleRomFile(file) { const fileName = file.name; const parts = fileName.split("."); const extension = parts.pop().toLowerCase(); const gameName = parts.join("."); if (["fds", "nes", "unif", "unf"].includes(extension)) { loadGame(file, gameName, defaultCore); } else { alert("–≠—Ç–æ—Ç —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è..."); } }

            // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã (–æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ + —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–¥–∞–≤–Ω–∏—Ö)
            function loadGame(romFile, gameName, core) {
                stopEmulator();

                // --- –ù–ï–î–ê–í–ù–ò–ï –ò–ì–†–´ ---
                let gameDataToStore = null;
                if (typeof romFile === 'string') { gameDataToStore = libraryGames.find(g => g.romUrl === romFile || g.title === gameName); }
                else if (romFile instanceof File) { gameDataToStore = libraryGames.find(g => g.title === gameName); if (!gameDataToStore) { console.log("–ó–∞–≥—Ä—É–∂–µ–Ω–Ω–∞—è –∏–≥—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ, –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–µ–¥–∞–≤–Ω–∏–µ."); } }
                if (gameDataToStore && gameDataToStore.id) {
                    try {
                        const MAX_RECENT_GAMES = 9;
                        let recentGames = JSON.parse(localStorage.getItem('recentGamesList') || '[]');
                        recentGames = recentGames.filter(g => g.id !== gameDataToStore.id);
                        recentGames.unshift({ id: gameDataToStore.id, title: gameDataToStore.title, romUrl: gameDataToStore.romUrl });
                        recentGames = recentGames.slice(0, MAX_RECENT_GAMES);
                        localStorage.setItem('recentGamesList', JSON.stringify(recentGames));
                    } catch (e) { console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–µ–¥–∞–≤–Ω–∏—Ö –∏–≥—Ä:", e); }
                }
                // --- –ö–û–ù–ï–¶ –ë–õ–û–ö–ê –ù–ï–î–ê–í–ù–ò–• –ò–ì–† ---

                window.currentRomUrl = romFile; window.currentGameName = gameName; window.orientationShown = false; window.isEmulatorActive = true;
                mainContent.classList.add('hidden'); searchResultsArea.classList.add('hidden');
                display.classList.remove('hidden'); backButton.style.display = 'flex'; reloadEmulatorButton.style.display = 'flex';
                if (isMobile) { enableFullscreen(); }
                window.EJS_player = "#game"; window.EJS_gameName = gameName; window.EJS_biosUrl = ""; window.EJS_gameUrl = romFile; window.EJS_core = core; window.EJS_pathtodata = "data/"; window.EJS_startOnLoaded = true; window.EJS_DEBUG_XX = enableDebug; window.EJS_disableDatabases = true; window.EJS_threads = enableThreads;
                window.EJS_onGameStart = function() { if (window.Telegram && window.Telegram.WebApp) { window.Telegram.WebApp.expand(); } setTimeout(fixCanvasScaling, 1000); };
                const script = document.createElement("script"); script.id = "emulatorScript"; script.src = "data/loader.js"; document.body.appendChild(script);
            }

            // –ö–Ω–æ–ø–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ –ò–ó –≠–ú–£–õ–Ø–¢–û–†–ê
            backButton.addEventListener('click', function() {
                stopEmulator(); display.classList.add('hidden'); mainContent.classList.remove('hidden'); searchResultsArea.classList.add('hidden'); backButton.style.display = 'none'; reloadEmulatorButton.style.display = 'none'; window.currentRomUrl = null; window.currentGameName = null; window.orientationShown = false; window.isEmulatorActive = false;
            });

            // –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —ç–º—É–ª—è—Ç–æ—Ä–∞
            reloadEmulatorButton.addEventListener('click', function() { loadingState.style.display = 'flex'; setTimeout(() => { reloadEmulator(); setTimeout(() => { loadingState.style.display = 'none'; }, 1500); }, 500); });

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ —ç–∫—Ä–∞–Ω–∞
            function checkOrientation() { const isPortrait = window.innerHeight > window.innerWidth; if (isPortrait && window.isEmulatorActive && window.innerWidth < 768 && isMobile && !window.orientationShown) { orientationMessage.style.opacity = '1'; orientationMessage.style.display = 'flex'; setTimeout(() => { if (orientationMessage.style.display !== 'none') { window.orientationShown = true; orientationMessage.style.display = 'none'; } }, 5000); } else if (!isPortrait && window.isEmulatorActive) { orientationMessage.style.display = 'none'; window.orientationShown = true; } if (window.isEmulatorActive && isMobile) { setTimeout(() => { if (!document.body.classList.contains('fullscreen-mode')) { enableFullscreen(); } else { fixCanvasScaling(); } }, 300); } }

            // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è canvas
            function fixCanvasScaling() { const canvasElements = document.querySelectorAll('#game canvas'); canvasElements.forEach(canvas => { canvas.style.objectFit = 'contain'; canvas.style.maxWidth = '100%'; canvas.style.maxHeight = '100%'; canvas.style.width = 'auto'; canvas.style.height = 'auto'; canvas.style.position = 'absolute'; canvas.style.left = '50%'; canvas.style.top = '50%'; canvas.style.transform = 'translate(-50%, -50%)'; canvas.style.backgroundColor = '#000'; canvas.style.imageRendering = 'pixelated'; }); const gameContainer = document.getElementById('game'); if (gameContainer && document.body.classList.contains('fullscreen-mode')) { gameContainer.style.width = '100%'; gameContainer.style.height = '100%'; gameContainer.style.display = 'flex'; gameContainer.style.alignItems = 'center'; gameContainer.style.justifyContent = 'center'; gameContainer.style.overflow = 'hidden'; gameContainer.style.backgroundColor = '#000'; } }

            // –í–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
            function enableFullscreen() { document.body.classList.add('fullscreen-mode'); document.body.classList.add('touch-disabled'); display.style.position = 'fixed'; display.style.top = '0'; display.style.left = '0'; display.style.width = '100vw'; display.style.height = '100vh'; display.style.maxHeight = 'none'; display.style.zIndex = '1000'; display.style.borderRadius = '0'; display.style.overflow = 'hidden'; display.style.backgroundColor = '#000'; fixCanvasScaling(); }

            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —ç–º—É–ª—è—Ç–æ—Ä–∞
            function reloadEmulator() { if (window.currentRomUrl && window.currentGameName) { stopEmulator(); setTimeout(() => { loadGame(window.currentRomUrl, window.currentGameName, defaultCore); }, 500); } }

            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —ç–º—É–ª—è—Ç–æ—Ä
            function stopEmulator() { stopAllAudio(); const gameContainer = document.getElementById('game'); while (gameContainer.firstChild) { gameContainer.removeChild(gameContainer.firstChild); } const oldScript = document.getElementById('emulatorScript'); if (oldScript) { oldScript.remove(); } window.EJS_player = null; window.EJS_gameUrl = null; window.EJS_core = null; window.EJS_pathtodata = null; window.EJS_startOnLoaded = null; window.EJS_onGameStart = null; if (window.EJS_emulator) { try { if (typeof window.EJS_emulator.pause === 'function') { window.EJS_emulator.pause(); } if (typeof window.EJS_emulator.stop === 'function') { window.EJS_emulator.stop(); } if (typeof window.EJS_emulator.destroy === 'function') { window.EJS_emulator.destroy(); } window.EJS_emulator = null; } catch (e) { console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ —ç–º—É–ª—è—Ç–æ—Ä–∞:", e); } } window.isEmulatorActive = false; }

            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –∞—É–¥–∏–æ
            function stopAllAudio() { try { const audioElements = document.querySelectorAll('audio'); audioElements.forEach(audio => { audio.pause(); audio.currentTime = 0; }); if (window.AudioContext || window.webkitAudioContext) { if (window.EJS_emulator && window.EJS_emulator.audioContext && typeof window.EJS_emulator.audioContext.close === 'function') { try { window.EJS_emulator.audioContext.close().catch(e => console.warn("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–∫—Ä—ã—Ç—å –∞—É–¥–∏–æ–∫–æ–Ω—Ç–µ–∫—Å—Ç", e)); } catch (e) { console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –∞—É–¥–∏–æ–∫–æ–Ω—Ç–µ–∫—Å—Ç–∞:", e); } } } } catch (e) { console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –∞—É–¥–∏–æ:", e); } }

            // –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram WebApp
            function initTelegramWebApp() { if (window.Telegram && window.Telegram.WebApp) { const tg = window.Telegram.WebApp; tg.ready(); tg.expand(); tg.enableClosingConfirmation(); if (tg.colorScheme === 'dark') { document.body.style.backgroundColor = tg.themeParams.bg_color || '#282c34'; document.body.style.color = tg.themeParams.text_color || '#ffffff'; } else { document.body.style.backgroundColor = tg.themeParams.bg_color || '#F5F5F5'; document.body.style.color = tg.themeParams.text_color || '#000000'; } } }

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏/—Ä–∞–∑–º–µ—Ä–∞
            window.addEventListener('orientationchange', () => setTimeout(checkOrientation, 300));
            window.addEventListener('resize', () => { checkOrientation(); if (window.isEmulatorActive) { setTimeout(fixCanvasScaling, 100); } });
            startPlayButton.addEventListener('click', (event) => { event.stopPropagation(); window.orientationShown = true; orientationMessage.style.display = 'none'; });
            orientationMessage.addEventListener('click', function() { window.orientationShown = true; this.style.display = 'none'; });

            // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞ –ø–æ–∏—Å–∫
            searchButton.addEventListener('click', performSearch);
            searchInput.addEventListener('keydown', (event) => { if (event.key === 'Enter') { event.preventDefault(); performSearch(); } });

            // --- –ù–ï–î–ê–í–ù–ò–ï –ò–ì–†–´ ---
            // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫—É "–ù–µ–¥–∞–≤–Ω–∏–µ"
            if (recentGamesButton) { recentGamesButton.addEventListener('click', showRecentGames); }

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            renderGamesGrid(libraryGames, initialRetroGamesGrid); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º "–•–∏—Ç—ã"
            initTelegramWebApp(); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –±–æ–ª—å—à–∏—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
            document.querySelectorAll('.featured-card').forEach(card => { card.addEventListener('click', function() { const title = this.querySelector('.featured-title').textContent; if (title === "–ö–ê–¢–ê–õ–û–ì –ò–ì–†") { const catalogSection = document.getElementById('retro-hits'); if (catalogSection) { catalogSection.scrollIntoView({ behavior: 'smooth' }); } } else if (title === "–ü–†–û–î–û–õ–ñ–ò–¢–¨ –ò–ì–†–£") { alert("–§—É–Ω–∫—Ü–∏—è '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏–≥—Ä—É' –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ!"); } }); });

            // –ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –≤ DOM
            const observer = new MutationObserver(function(mutations) { mutations.forEach(function(mutation) { if (mutation.addedNodes && mutation.addedNodes.length > 0) { for (let i = 0; i < mutation.addedNodes.length; i++) { const node = mutation.addedNodes[i]; if (node.nodeName === 'CANVAS' || (node.classList && node.classList.contains('ejs_canvas'))) { setTimeout(fixCanvasScaling, 50); break; } } } }); });
            observer.observe(document.getElementById('game'), { childList: true, subtree: true });
        });
    </script>
</body>
</html>